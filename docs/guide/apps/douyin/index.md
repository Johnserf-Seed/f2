---
outline: deep
---

# æ¥å£åˆ—è¡¨

::: tip æ³¨æ„
ğŸŸ¢ä»£è¡¨å·²ç»å®ç°ï¼ŒğŸŸ¡ä»£è¡¨æ­£åœ¨å®ç°æˆ–ä¿®æ”¹ï¼ŒğŸŸ¤ä»£è¡¨æš‚æ—¶ä¸å®ç°ï¼ŒğŸ”µä»£è¡¨æœªæ¥å¯èƒ½å®ç°ï¼ŒğŸ”´ä»£è¡¨å°†ä¼šå¼ƒç”¨ã€‚
:::

::: details handleræ¥å£åˆ—è¡¨

|     CLIæ¥å£             |         æ–¹æ³•        |
| :------------------ | :-------------------  |
| ä¸‹è½½å•ä¸ªä½œå“          | handle_one_video      |
| ä¸‹è½½ç”¨æˆ·å‘å¸ƒä½œå“       | handle_user_post      |
| ä¸‹è½½ç”¨æˆ·å–œæ¬¢ä½œå“       | handle_user_like      |
| ä¸‹è½½ç”¨æˆ·æ”¶è—ä½œå“       | handle_user_collect   |
| ä¸‹è½½ç”¨æˆ·åˆè¾‘ä½œå“       | handle_user_mix       |
| ä¸‹è½½ç”¨æˆ·ç›´æ’­æµ         | handle_user_live      |
| ä¸‹è½½ç”¨æˆ·é¦–é¡µæ¨èä½œå“    | handle_user_feed      |

|     æ•°æ®ä¸åŠŸèƒ½æ¥å£     |         æ–¹æ³•           | å¼€å‘è€…æ¥å£  |
| :------------------ | :-------------------  | :--------: |
| å•ä¸ªä½œå“æ•°æ®          | fetch_one_video        |     ğŸŸ¢      |
| ç”¨æˆ·å‘å¸ƒä½œå“æ•°æ®       | fetch_user_post_videos |     ğŸŸ¢      |
| ç”¨æˆ·å–œæ¬¢ä½œå“æ•°æ®       | fetch_user_like_videos |     ğŸŸ¢      |
| ç”¨æˆ·æ”¶è—ä½œå“æ•°æ®       | fetch_user_collect_videos |  ğŸŸ¢      |
| ç”¨æˆ·åˆè¾‘ä½œå“æ•°æ®       | fetch_user_mix_videos  |     ğŸŸ¢      |
| ç”¨æˆ·ç›´æ’­æµæ•°æ®         | fetch_user_live_videos |     ğŸŸ¢      |
| ç”¨æˆ·ç›´æ’­æµæ•°æ®2        | fetch_user_live_videos_by_room_id |     ğŸŸ¢      |
| ç”¨æˆ·é¦–é¡µæ¨èä½œå“æ•°æ®    | fetch_user_feed_videos |     ğŸŸ¢      |
| ......               | ......                 |    ğŸ”µ      |
| ç”¨æˆ·ä¿¡æ¯              | handler_user_profile   |     ğŸŸ¢      |
| è·å–æŒ‡å®šç”¨æˆ·å         | get_user_nickname      |      ğŸ”´     |
| åˆ›å»ºç”¨æˆ·è®°å½•ä¸ç›®å½•      | get_or_add_user_data   |     ğŸŸ¡ğŸ”´  |
| åˆ›å»ºä½œå“ä¸‹è½½è®°å½•        | get_or_add_video_data  |     ğŸŸ¢      |
| SSOç™»å½•              |  handle_sso_login       |     ğŸŸ¢      |
:::

::: details utilsæ¥å£åˆ—è¡¨

| å¼€å‘è€…æ¥å£          | ç±»å            | æ–¹æ³•               | çŠ¶æ€ |
| :---------------- | :-------------- | :------------------  | :--: |
| ç”ŸæˆçœŸå®msToken    | TokenManager     | gen_real_msToken       |  ğŸŸ¢  |
| ç”Ÿæˆè™šå‡msToken     | TokenManager     | gen_false_msToken      |  ğŸŸ¢  |
| ç”Ÿæˆttwid          | TokenManager     | gen_ttwid              |  ğŸŸ¢  |
| ç”Ÿæˆverify_fp      | VerifyFpManager  | gen_verify_fp          |  ğŸŸ¢  |
| ç”Ÿæˆs_v_web_id     | VerifyFpManager  | gen_s_v_web_id         |  ğŸŸ¢  |
| ç”ŸæˆXboguså‚æ•°      | XBogusManager    | to_complete_endpoint   |  ğŸŸ¢  |
| æå–å•ä¸ªç”¨æˆ·id       | SecUserIdFetcher | get_sec_user_id         |  ğŸŸ¢  |
| æå–åˆ—è¡¨ç”¨æˆ·id       | SecUserIdFetcher | get_all_sec_user_id     |  ğŸŸ¢  |
| æå–å•ä¸ªä½œå“id       | AwemeIdFetcher   | get_aweme_id            |  ğŸŸ¢  |
| æå–åˆ—è¡¨ä½œå“id       | AwemeIdFetcher   | get_all_aweme_id        |  ğŸŸ¢  |
| æå–åˆè¾‘id          | MixIdFetcher     | -                       |  ğŸŸ¤  |
| æå–å•ä¸ªç›´æ’­é—´å·      | WebCastIdFetcher | get_webcast_id          |  ğŸŸ¢  |
| æå–åˆ—è¡¨ç›´æ’­é—´å·      | WebCastIdFetcher | get_all_webcast_id      |  ğŸŸ¢  |
| è·å–è¯·æ±‚countæ•°åˆ—è¡¨  | -                 | get_request_sizes       |  ğŸ”´  |
| å…¨å±€æ ¼å¼åŒ–æ–‡ä»¶å     | -                 | format_file_name        |  ğŸŸ¢  |
| åˆ›å»ºç”¨æˆ·ç›®å½•         | -                 | create_user_folder      |  ğŸŸ¢  |
| é‡å‘½åç”¨æˆ·ç›®å½•       | -                | rename_user_folder      |  ğŸŸ¢  |
| åˆ›å»ºæˆ–é‡å‘½åç”¨æˆ·ç›®å½•  | -                 | create_or_rename_user_folder | ğŸŸ¢ |
| æå–ä½ç‰ˆæœ¬æ¥å£çš„desc  | -                | extract_desc_from_share_desc | ğŸ”´ |
| æ˜¾ç¤ºäºŒç»´ç            | -                | show_qrcode             |  ğŸŸ¢  |
::: tip æ³¨æ„
åˆè¾‘idå…¶å®å°±æ˜¯ä½œå“idï¼Œä½¿ç”¨`AwemeIdFetcher`å³å¯ã€‚
:::

::: details cralweræ¥å£åˆ—è¡¨

| çˆ¬è™«urlæ¥å£    | ç±»å       | æ–¹æ³•          | çŠ¶æ€ |
| :----------- | :--------- | :----------  | :--: |
| ç”¨æˆ·ä¿¡æ¯æ¥å£åœ°å€ | DouyinCrawler | fetch_user_profile |  ğŸŸ¢  |
| ä¸»é¡µä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_user_post |  ğŸŸ¢  |
| å–œæ¬¢ä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_user_like |  ğŸŸ¢  |
| æ”¶è—ä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_user_collect |  ğŸŸ¢  |
| åˆè¾‘ä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_user_mix |  ğŸŸ¢  |
| ä½œå“è¯¦æƒ…æ¥å£åœ°å€ | DouyinCrawler | fetch_post_detail |  ğŸŸ¢  |
| ä½œå“è¯„è®ºæ¥å£åœ°å€ | DouyinCrawler | fetch_post_comment |  ğŸŸ¡  |
| æ¨èä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_post_feed |  ğŸŸ¡  |
| å…³æ³¨ä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_follow_feed |  ğŸŸ¡  |
| æœ‹å‹ä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_friend_feed |  ğŸŸ¡  |
| ç›¸å…³æ¨èä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_post_related |  ğŸŸ¡  |
| ç›´æ’­æ¥å£åœ°å€ | DouyinCrawler | fetch_live |  ğŸŸ¢  |
| ç›´æ’­æ¥å£åœ°å€ï¼ˆroom_idï¼‰ | DouyinCrawler | fetch_live_room_id |  ğŸŸ¢  |
| å…³æ³¨ç”¨æˆ·ç›´æ’­æ¥å£åœ°å€ | DouyinCrawler | fetch_follow_live |  ğŸŸ¡  |
| å®šä½ä¸Šä¸€æ¬¡ä½œå“æ¥å£åœ°å€ | DouyinCrawler | fetch_locate_post |  ğŸŸ¡  |
| SSOè·å–äºŒç»´ç æ¥å£åœ°å€ | DouyinCrawler | fetch_login_qrcode |  ğŸŸ¢  |
| SSOæ£€æŸ¥æ‰«ç çŠ¶æ€æ¥å£åœ°å€ | DouyinCrawler | fetch_check_qrcode |  ğŸŸ¢  |
| SSOæ£€æŸ¥ç™»å½•çŠ¶æ€æ¥å£åœ°å€ | DouyinCrawler | fetch_check_login |  ğŸŸ¡  |

:::

::: details dlæ¥å£åˆ—è¡¨

| ä¸‹è½½å™¨æ¥å£     | ç±»å        | æ–¹æ³•          | çŠ¶æ€ |
| :----------- | :--------- | :----------  | :--: |
| ä¿å­˜æœ€åä¸€æ¬¡è¯·æ±‚çš„aweme_id | DouyinDownloader | save_last_aweme_id |  ğŸŸ¢  |
| åˆ›å»ºä¸‹è½½ä»»åŠ¡   | DouyinDownloader | create_download_task |  ğŸŸ¢  |
| å¤„ç†ä¸‹è½½ä»»åŠ¡   | DouyinDownloader | handle_download |  ğŸŸ¢  |
| åˆ›å»ºæµä¸‹è½½ä»»åŠ¡  | DouyinDownloader | create_stream_tasks |  ğŸŸ¢  |
| å¤„ç†æµä¸‹è½½ä»»åŠ¡  | DouyinDownloader | handle_stream |  ğŸŸ¢  |
:::

## handleræ¥å£åˆ—è¡¨

### å•ä¸ªä½œå“æ•°æ®

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–å•ä¸ªè§†é¢‘ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| aweme_id| str | è§†é¢‘ID |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| video_data | dict | è§†é¢‘æ•°æ®å­—å…¸ï¼ŒåŒ…å«è§†é¢‘IDã€è§†é¢‘æ–‡æ¡ˆã€ä½œè€…æ˜µç§°ç­‰ |

<<< @/snippets/douyin/one-video.py{5,7}

### ç”¨æˆ·å‘å¸ƒä½œå“æ•°æ®

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–ç”¨æˆ·å‘å¸ƒçš„è§†é¢‘åˆ—è¡¨ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| sec_user_id| str | ç”¨æˆ·ID |
| max_cursor| int | é¡µç ï¼Œåˆå§‹ä¸º0 |
| page_counts| int | é¡µæ•°ï¼Œåˆå§‹ä¸º20 |
| max_counts| int | æœ€å¤§é¡µæ•°ï¼Œåˆå§‹ä¸ºNone |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| video_data | dict | è§†é¢‘æ•°æ®å­—å…¸ï¼ŒåŒ…å«è§†é¢‘IDã€è§†é¢‘æ–‡æ¡ˆã€ä½œè€…æ˜µç§°ã€é¡µç ç­‰ |

<<< @/snippets/douyin/user-post.py{5,7,12}

### ç”¨æˆ·å–œæ¬¢ä½œå“æ•°æ®

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·å–œæ¬¢çš„è§†é¢‘åˆ—è¡¨ï¼Œéœ€å¼€æ”¾å–œæ¬¢åˆ—è¡¨ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| sec_user_id| str | ç”¨æˆ·ID |
| max_cursor| int | é¡µç ï¼Œåˆå§‹ä¸º0 |
| page_counts| int | é¡µæ•°ï¼Œåˆå§‹ä¸º20 |
| max_counts| int | æœ€å¤§é¡µæ•°ï¼Œåˆå§‹ä¸ºNone |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| aweme_data | dict | è§†é¢‘æ•°æ®å­—å…¸ï¼ŒåŒ…å«è§†é¢‘IDã€è§†é¢‘æ–‡æ¡ˆã€ä½œè€…æ˜µç§°ã€é¡µç ç­‰ |

<<< @/snippets/douyin/user-like.py{5,7,12}

### ç”¨æˆ·æ”¶è—ä½œå“æ•°æ®

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·æ”¶è—çš„è§†é¢‘åˆ—è¡¨ï¼Œåªèƒ½çˆ¬ç™»å½•äº†è´¦å·çš„æ”¶è—ä½œå“ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| max_cursor| int | é¡µç ï¼Œåˆå§‹ä¸º0 |
| page_counts| int | é¡µæ•°ï¼Œåˆå§‹ä¸º20 |
| max_counts| int | æœ€å¤§é¡µæ•°ï¼Œåˆå§‹ä¸ºNone |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| aweme_data | dict | è§†é¢‘æ•°æ®å­—å…¸ï¼ŒåŒ…å«è§†é¢‘IDã€è§†é¢‘æ–‡æ¡ˆã€ä½œè€…æ˜µç§°ã€é¡µç ç­‰ |

<<< @/snippets/douyin/user-collect.py{6,11}

### ç”¨æˆ·åˆè¾‘ä½œå“æ•°æ®

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·åˆè¾‘çš„è§†é¢‘åˆ—è¡¨ï¼Œåˆè¾‘è§†é¢‘çš„mix_idæ˜¯ä¸€è‡´çš„ï¼Œä»å•ä¸ªä½œå“æ•°æ®æ¥å£ä¸­è·å–å³å¯ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| mix_id| str | åˆé›†ID |
| max_cursor| int | é¡µç ï¼Œåˆå§‹ä¸º0 |
| page_counts| int | é¡µæ•°ï¼Œåˆå§‹ä¸º20 |
| max_counts| int | æœ€å¤§é¡µæ•°ï¼Œåˆå§‹ä¸ºNone |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| aweme_data | dict | è§†é¢‘æ•°æ®å­—å…¸ï¼ŒåŒ…å«è§†é¢‘IDã€è§†é¢‘æ–‡æ¡ˆã€ä½œè€…æ˜µç§°ã€é¡µç ç­‰ |

<<< @/snippets/douyin/user-mix.py{5,7,12}

### ç”¨æˆ·ç›´æ’­æµæ•°æ®

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·çš„ç›´æ’­ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| webcast_id| str | ç›´æ’­é—´RID |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| webcast_data | dict | ç›´æ’­æ•°æ®å­—å…¸ï¼ŒåŒ…å«ç›´æ’­IDã€ç›´æ’­æ ‡é¢˜ã€ç›´æ’­çŠ¶æ€ã€è§‚çœ‹äººæ•°ã€å­åˆ†åŒºã€ä¸»æ’­æ˜µç§°ç­‰ |

<<< @/snippets/douyin/user-live.py{5}

### ç”¨æˆ·ç›´æ’­æµæ•°æ®2

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·çš„ç›´æ’­ï¼Œwebcast_idä¸room_idä¸º2ä¸ªç‹¬ç«‹å‚æ•°ï¼Œç”±ä¸åŒæ¥å£è§£æã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| room_id| str | ç›´æ’­é—´ID |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| webcast_data | dict | ç›´æ’­æ•°æ®å­—å…¸ï¼ŒåŒ…å«ç›´æ’­IDã€ç›´æ’­æ ‡é¢˜ã€ç›´æ’­çŠ¶æ€ã€è§‚çœ‹äººæ•°ã€å­åˆ†åŒºã€ä¸»æ’­æ˜µç§°ç­‰ |

<<< @/snippets/douyin/user-live-room-id.py{5}

### ç”¨æˆ·ä¿¡æ¯

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·çš„ä¿¡æ¯ï¼Œä¸å¯ä»¥ç›´æ¥è§£æFilterçš„æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çš„_to_dict()æˆ–_to_list()æ–¹æ³•ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| sec_user_id| str | ç”¨æˆ·ID |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| UserProfileFilter | _to_dict() | è‡ªå®šä¹‰çš„æ¥å£æ•°æ®è¿‡æ»¤å™¨ | ç”¨æˆ·æ•°æ®å­—å…¸ï¼ŒåŒ…å«ç”¨æˆ·IDã€ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ·ç­¾åã€ç”¨æˆ·å¤´åƒç­‰ |

<<< @/snippets/douyin/user-profile.py{5,6}

### è·å–æŒ‡å®šç”¨æˆ·å

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æŒ‡å®šç”¨æˆ·çš„æ˜µç§°ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»æœåŠ¡å™¨è·å–å¹¶å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| sec_user_id| str | ç”¨æˆ·ID |
| db | AsyncUserDB | ç”¨æˆ·æ•°æ®åº“ |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| user_nickname | str | ç”¨æˆ·æ˜µç§° |

<<< @/snippets/douyin/user-nickname.py{5-7}

### åˆ›å»ºç”¨æˆ·è®°å½•ä¸ç›®å½•

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æˆ–åˆ›å»ºç”¨æˆ·æ•°æ®åŒæ—¶åˆ›å»ºç”¨æˆ·ç›®å½•ã€‚


| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| kwargs | dict | cliå­—å…¸æ•°æ®ï¼Œéœ€è·å–pathå‚æ•° |
| sec_user_id| str | ç”¨æˆ·ID |
| db | AsyncUserDB | ç”¨æˆ·æ•°æ®åº“ |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| user_path | Path | ç”¨æˆ·ç›®å½•è·¯å¾„å¯¹è±¡ |

<<< @/snippets/douyin/user-get-add.py{5-8}

::: tip æç¤º
æ­¤ä¸ºcliæ¨¡å¼çš„æ¥å£ï¼Œå¼€å‘è€…å¯è‡ªè¡Œå®šä¹‰åˆ›å»ºç”¨æˆ·ç›®å½•çš„åŠŸèƒ½ã€‚
:::

### åˆ›å»ºä½œå“ä¸‹è½½è®°å½•

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºè·å–æˆ–åˆ›å»ºä½œå“æ•°æ®åŒæ—¶åˆ›å»ºä½œå“ç›®å½•ã€‚

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| aweme_data | dict | ä½œå“æ•°æ®å­—å…¸ |
| db | AsyncVideoDB | ä½œå“æ•°æ®åº“ |
| ignore_fields | list | å¿½ç•¥çš„å­—æ®µåˆ—è¡¨ |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
|None | None | æ—  |

<<< @/snippets/douyin/video-get-add.py{5,8-10}

### SSOç™»å½•

å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºå¤„ç†ç”¨æˆ·SSOç™»å½•ï¼Œè·å–ç”¨æˆ·çš„cookieã€‚


| å‚æ•° | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
|None | None | æ—  |

| è¿”å› | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| is_login | bool | æ˜¯å¦ç™»å½•æˆåŠŸ |
| login_cookie | str | ç™»å½•cookie |

<<< @/snippets/douyin/sso-login.py

::: danger è­¦å‘Š
ç”±äºæ‰«ç ç™»å½•å—é£æ§å½±å“è¾ƒå¤§,å¤šæ•°cookieéƒ½æ— æ³•ä½¿ç”¨ã€‚ä¸ºäº†ä¿éšœä½“éªŒï¼Œå»ºè®®ä½¿ç”¨--auto-cookieå‘½ä»¤è‡ªåŠ¨ä»æµè§ˆå™¨è·å–cookieï¼Œæ›´å¤šä½¿ç”¨å¸®åŠ©å‚è€ƒcliå‘½ä»¤ã€‚
:::
